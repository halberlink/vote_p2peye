<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title></title>
	<script type="text/javascript" src="https://www.p2peye.com/static/scripts/lib/jquery.1.8.3.js"></script>
</head>
<body>
<div class="regiser" style="display: none;">
	<input type="text" name="uname" placeholder="输入你的名字" />
	<input onclick="register()" type="button" name="" value="登入"/>
</div>
<script type="text/javascript">

	var ws = new WebSocket("ws://192.168.5.154:4000");
	function createSocket(){
        ws.onopen = function(){
            console.log("握手成功");
        }
        ws.onmessage = function(e){
        	console.log(1111);
            console.log("message:" + e.data);
        }
        ws.onerror = function(){
            console.log("error");
        }
    }



	var regiserpostting = false;
	function register(){
		if(regiserpostting) return;
		var uname = $.trim($('input[name=uname]').val());
		if(uname == ''){
			alert('请输入一个名字');
			return;
		}
		regiserpostting = true;

		$.ajax({
			url : '/server/register.php',
			data : {name : uname},
			type : 'post',
			dataType : 'json',
			success : function(ret){
				if(ret.code == 200){
					localStorage.setItem('uid',ret.data[0].id);
				}else{
					alert(ret.message);
				}
				regiserpostting = false;
			}
		})


	}

	var uid = localStorage.getItem('uid');

	if(!uid){
		$('.regiser').show();
	}else{
		//window.location.href = '/';

		createSocket();


	}




	
</script>
</body>
</html>